<!DOCTYPE html>
<html>
<head>
  <title>Snapchat Login Demo</title>
</head>
<body>
  <h1>Snapchat Login Demo</h1>

  <button id="loginBtn">Login with Snapchat</button>

  <p id="message"></p>

  <script>
    const clientId = '5d95706f-c76f-41ce-b5d5-cb3e3c64a0e4'; // Replace this
    const redirectUri = window.location.origin + window.location.pathname;

    const loginBtn = document.getElementById('loginBtn');
    const message = document.getElementById('message');

    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    function startLogin() {
      const state = Math.random().toString(36).substring(2); // random state
      localStorage.setItem('snap_state', state);

      const authUrl = `https://accounts.snapchat.com/accounts/oauth2/auth?` +
        `client_id=${encodeURIComponent(clientId)}` +
        `&redirect_uri=${encodeURIComponent(redirectUri)}` +
        `&response_type=code` +
        `&scope=snapchat-display-name` +
        `&state=${encodeURIComponent(state)}`;

      window.location.href = authUrl;
    }

    function handleRedirect() {
      const code = getQueryParam('code');
      const state = getQueryParam('state');
      const savedState = localStorage.getItem('snap_state');

      if (code) {
        if (state !== savedState) {
          message.textContent = 'Error: Invalid state parameter.';
          return;
        }
        message.textContent = 'Authorization code received: ' + code + '\n' +
          'Now send this code to your backend to exchange for an access token and fetch user info.';
      }
    }

    loginBtn.addEventListener('click', startLogin);

    // Check if redirected back with code
    handleRedirect();
  </script>
</body>
</html>
